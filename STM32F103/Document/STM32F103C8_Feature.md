## STM32F103C8 的特性

|              |                     |
| ------------ | ------------------- |
| 最高工作频率 | 72MHZ               |
| 存储器       | 64K Falsh; 20K SRAM |

## 系统时钟和启动

- 上电复位或启动时 CPU 默认选择内部 8MHz 的 RC 振荡器作为 CPU 时钟；
  - 当然，启动之后可以设置成外部晶振，PLL，或内部低速时钟等时钟作为 CPU 时钟

|                           |                                                     |
| ------------------------- | --------------------------------------------------- |
| STM32F103xx增强型模块框图 | ![img](./img/2022-07-07_215636_STM32F103_Modul.png) |
| STM32F103xx时钟树         | ![img](./img/2022-07-07_215830_Clock_tree.png)      |

## 供电方案

- VDD = 2.0～3.6V：VDD引脚为I/O引脚和内部调压器供电。
- VSSA，VDDA = 2.0～3.6V：为ADC、复位模块、RC振荡器和PLL的模拟部分提供供电
  - 使用ADC时，VDDA不得小于2.4V。
  - VDDA和VSSA必须分别连接到VDD和VSS。
- VBAT = 1.8～3.6V：当关闭VDD时，(通过内部电源切换器)为RTC、外部32kHz振荡器和后备寄存器供电

## 定时器和看门狗

- 1个高级控制定时器（TIM1）
- 3个普通定时器（TIM2,TIM3,TIM4）
- 2个看门狗定时器（独立看门狗，窗口看门狗）
  - 独立看门狗：12位递减计数器，8位预分频；还可用作复位，超时管理等
  - 窗口看门狗：7位递减计数器，只可以用作看门狗，复位系统
- 1个系统嘀嗒定时器：24位递减计数器，Cortex-M3 内核产生

## 存储器

### 存储器区域划分

STM32 是 ARM 内核的；STM32F103 是 M3 内核，STM32F407 是 M4 内核；
ARM 公司本身定义了一个 4G 的存储器，用来更好的扩展；4G 空间分成 8 个块，每个块 512MB；每块都有特殊的用途；STM 公司只用到了前几个块

- Block 0：存放 Flash；自举程序；芯片选项字节
- Block 1：存放 SRAM
- Block 2：存放 片上外设
- Block 3/4/5：存放 FSMC 用于拓展外部存储器，SRAM，NORFLASH等

|                      |                                                     |
| -------------------- | --------------------------------------------------- |
| ARM 内部的存储器分块 | ![img](./img/2022-07-09_223625_Arm_Block.png)       |
| STM32F103 使用到的块 | ![img](./img/2022-07-09_223719_STM32F103_Block.png) |

- Flash memory address: [0x08000000,0x0801FFFF]
- Peripherals address: [0x40000000,0x40023400]

注意：自举程序就是通过 BOOT0 和 BOOT1 选择启动程序是从串口接口烧录程序或是主闪存启动程序

### 寄存器

- 低速设备挂载在 APB1 总线上，高速设备挂载在 APB2，AHB 总线上；
- STM32 库访问寄存器的方式是：总线基地址 + 相对偏移地址
- STM32 库设置寄存器内容，用到 C 语言的指针，通过指针访问地址内容
- STM32 库使用结构体对封装寄存器，便于使用

|            |                                             |
| ---------- | ------------------------------------------- |
| 寄存器指针 | ![img](./img/2022-07-09_225555_Pointer.png) |
| 寄存器封装 | ![img](./img/2022-07-09_225915_Struct.png)  |

## 创建新工程

### 使用寄存器模板

一个工程必须的文件

- 启动文件 startup_stm32f10x_hd.s 和 startup_stm32f10x_md.s 都可以
  - startup_stm32f10x_hd.s 是大容量的芯片有更多的外设定义
  - startup_stm32f10x_md.s 是中容量的芯片，外设定义少一些
  - STM32 是向下兼容的，所以，使用 startup_s tm32f10x_hd.s 就可以
- stm32F10x.h 芯片头文件，包含芯片内部的寄存器定义，内核等内容
  - 这个头文件提示需要包含 “core_cm3.h” 内核文件
- main.c 主函数
  - 需要定义一个方法 SystemInit(); 因为启动文件 hd.s 是先从 SystemInit 方法启动的；
- 最简易的工程就创建完了
